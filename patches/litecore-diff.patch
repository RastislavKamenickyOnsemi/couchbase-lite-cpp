diff --git a/CMakeLists.txt b/CMakeLists.txt
index 89fe9f8a..a8126072 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -46,6 +46,14 @@ add_definitions(-DSQLITE_OMIT_LOAD_EXTENSION        # This one's for SQLiteCpp
                 -DSQLITE_ENABLE_FTS3_PARENTHESIS
                 -DSQLITE_ENABLE_FTS3_TOKENIZER)

+if(DEFINED SSL_LIB AND DEFINED CRYPTO_LIB)
+    if("${SSL_LIB}" STREQUAL "" OR "${CRYPTO_LIB}" STREQUAL "")
+        add_definitions(-DNO_SSL)
+    else()
+        add_definitions(-DOPENSSL_API_1_1 -DSSL_LIB=${SSL_LIB} -DCRYPTO_LIB=${CRYPTO_LIB})
+    endif()
+endif()
+
 if(BUILD_ENTERPRISE)
     add_definitions(-DCOUCHBASE_ENTERPRISE      # Tells LiteCore it's an EE build
                     -DSQLITE_HAS_CODEC          # Enables SQLite encryption extension (SEE)
diff --git a/Replicator/CivetWebSocket.cc b/Replicator/CivetWebSocket.cc
index b353b185..6c3c562c 100644
--- a/Replicator/CivetWebSocket.cc
+++ b/Replicator/CivetWebSocket.cc
@@ -120,7 +120,7 @@ namespace litecore { namespace websocket {
         ,_address(to)
         ,_options(options)
         {
-            mg_init_library(0);
+            mg_init_library(2);
         }

         ~CivetWebSocket() {
diff --git a/Replicator/Replicator.cc b/Replicator/Replicator.cc
index 0bd8f4c4..6a338d17 100644
--- a/Replicator/Replicator.cc
+++ b/Replicator/Replicator.cc
@@ -174,7 +174,7 @@ namespace litecore { namespace repl {
             case Connection::kDisconnected:
             case Connection::kClosed:
                 // After connection closes, remain active while I wait for db to finish writes:
-                level = (_dbStatus.level == kC4Busy) ? kC4Busy : kC4Stopped;
+                level = (max(max(Worker::computeActivityLevel(), _dbStatus.level), max(_pushStatus.level, _pullStatus.level)) == kC4Busy) ? kC4Busy : kC4Stopped;
                 break;
         }
         if (SyncBusyLog.effectiveLevel() <= LogLevel::Info) {
